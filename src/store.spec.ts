// TODO: test blocking() and upgradeNeeded()
// TODO: Test race
